<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>Extensibility with HK2</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      </head>
  <body class="composite">
    <!-- TODO: move this into JavaScript to patch the skin
      <div class="xright">  </div>
    -->
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Compatibility<a name="Compatibility"></a></h2><p>This page describes modularity with the HK2 2.0 API, which is based on the JSR-330 standard annotations. Also, Habitat has been replaced with a new interface called <a href="./apidocs/org/glassfish/hk2/api/ServiceLocator.html">ServiceLocator</a>. More information can be found <a href="./index.html">here</a>.</p></div><div class="section"><h2>Extensibility of HK2<a name="Extensibility_of_HK2"></a></h2><p>HK2 is extensible along many dimensions. This page is intended to give an overview and example of each dimension along which users can customize thier HK2 environment. Among the set of things which can be extended are these:</p><ul><li><a href="#Adding_a_Scope_and_Context_to_the_system">Adding a Scope and Context to the system</a></li><li><a href="#Dealing_with_ClassLoading_issues">Dealing with ClassLoading issues</a></li><li><a href="#Custom_Injection_Resolvers">Custom Injection Resolvers</a></li><li><a href="#Validation">Validation</a></li><li><a href="#Instance_Lifecycle">Instance Lifecycle</a></li></ul><div class="section"><h3><a name="Adding_a_Scope_and_Context_to_the_system">Adding a Scope and Context to the system</a></h3><p>In HK2 a <a href="./apidocs/org/glassfish/hk2/api/Context.html">Context</a> is a class that is used to control the lifecycle of service instances. A <a class="externalLink" href="http://docs.oracle.com/javaee/6/api/javax/inject/Scope.html">Scope</a> is an annotation that is put onto another annotation that is used to associate any service with a particular <a href="./apidocs/org/glassfish/hk2/api/Context.html">Context</a>. All services in HK2 are associated with a single scope.</p><p>There are two system provided scope/context pairs. The default <a class="externalLink" href="http://docs.oracle.com/javaee/6/api/javax/inject/Scope.html">Scope</a> for services annotated with <a href="./apidocs/org/jvnet/hk2/annotations/Service.html">@Serivce</a> is the <a class="externalLink" href="http://docs.oracle.com/javaee/6/api/javax/inject/Singleton.html">Singleton</a> scope. Service instances in the <a class="externalLink" href="http://docs.oracle.com/javaee/6/api/javax/inject/Singleton.html">Singleton</a> scope are created once and are never destroyed.</p><p>The default <a class="externalLink" href="http://docs.oracle.com/javaee/6/api/javax/inject/Scope.html">Scope</a> for services bound with the <a href="./apidocs/org/glassfish/hk2/api/DynamicConfiguration.html">DynamicConfiguration</a> bind call is <a href="./apidocs/org/glassfish/hk2/api/PerLookup.html">PerLookup</a>. Service instances in the <a href="./apidocs/org/glassfish/hk2/api/PerLookup.html">PerLookup</a> scope are created every time that the service is injected or looked up via the API. These instances are destroyed when the <a href="./apidocs/org/glassfish/hk2/api/ServiceHandle.html">ServiceHandle</a> destroy method is called on any service that has injected a <a href="./apidocs/org/glassfish/hk2/api/PerLookup.html">PerLookup</a> object.</p><p>Any number of other scope/context pairs can be added to the system. In order to do so, the user must write an implementation of <a href="./apidocs/org/glassfish/hk2/api/Context.html">Context</a> where the parameterized type of the <a href="./apidocs/org/glassfish/hk2/api/Context.html">Context</a> is the annotation annotated with <a class="externalLink" href="http://docs.oracle.com/javaee/6/api/javax/inject/Scope.html">Scope</a> that the <a href="./apidocs/org/glassfish/hk2/api/Context.html">Context</a> is handling. This implementation of <a href="./apidocs/org/glassfish/hk2/api/Context.html">Context</a> is then bound into the <a href="./apidocs/org/glassfish/hk2/api/ServiceLocator.html">ServiceLocator</a> like any other service.</p><p>To make this more clear, we have two examples of user scope/context pairs:</p><ol style="list-style-type: decimal"><li>This <a href="../examples/ctm-example/index.html">example</a> adds a context that is based on the current running tenant.</li><li>This <a href="../examples/custom-resolver-example/index.html">example</a> adds a request scoped context.</li></ol></div><div class="section"><h3><a name="Dealing_with_ClassLoading_issues">Dealing with ClassLoading issues</a></h3><p>Classloading is an interesting challenge in any Java environment. HK2 defers classloading as long as possible, but at some point, it must get access to the true class in order to create and inject instances. At that moment, HK2 will attempt to reify the descriptor, using the <a href="./apidocs/org/glassfish/hk2/api/ServiceLocator.html">ServiceLocator</a> reify method.</p><p>Every <a href="./apidocs/org/glassfish/hk2/api/Descriptor.html">Descriptor</a> bound into the system has an associated <a href="./apidocs/org/glassfish/hk2/api/HK2Loader.html">HK2Loader</a>. If the getLoader method of <a href="./apidocs/org/glassfish/hk2/api/Descriptor.html">Descriptor</a> returns null, then the system defined algorithm for loading classes will be used. Otherwise, the given <a href="./apidocs/org/glassfish/hk2/api/HK2Loader.html">HK2Loader</a> will be used to load the class described by this <a href="./apidocs/org/glassfish/hk2/api/Descriptor.html">Descriptor</a>.</p><p>The system algorithm used when the getLoader method of <a href="./apidocs/org/glassfish/hk2/api/Descriptor.html">Descriptor</a> returns null is to first consult the classloader of the class being injected into, if available. If not available, HK2 will use the classloader that loaded HK2 itself. Failing this, the class will fail to be loaded and an exception will be thrown.</p><p>Note that since the user is providing an implementation of <a href="./apidocs/org/glassfish/hk2/api/HK2Loader.html">HK2Loader</a> rather than a java.lang.ClassLoader that it is possible to delay the instantiation of the underlying ClassLoader until the <a href="./apidocs/org/glassfish/hk2/api/Descriptor.html">Descriptor</a> is being reified. It might also be possible to have the implementation of <a href="./apidocs/org/glassfish/hk2/api/HK2Loader.html">HK2Loader</a> consult several underlying ClassLoaders, or construct the class dynamically using weaving or some other class building technology. The mind boggles at all the ways <a href="./apidocs/org/glassfish/hk2/api/HK2Loader.html">HK2Loader</a> can be implemented.</p></div><div class="section"><h3><a name="Custom_Injection_Resolvers">Custom Injection Resolvers</a></h3><p>By default the system provides JSR-330 standard injection. That means honoring <a class="externalLink" href="http://docs.oracle.com/javaee/6/api/javax/inject/Inject.html">@Inject</a> and all other parts of the JSR-330 specification. (For more information see TBD). However, it is sometimes the case that a user would like to customize the JSR-330 resolution in some manner, or provide their own injection points based on a different annotation.</p><p>In order to do so, the user implements <a href="./apidocs/org/glassfish/hk2/api/InjectionResolver.html">InjectionResolver</a>. The parameterized type of the <a href="./apidocs/org/glassfish/hk2/api/InjectionResolver.html">InjectionResolver</a> must be the injection annotation that they will resolve. The user implementation of <a href="./apidocs/org/glassfish/hk2/api/InjectionResolver.html">InjectionResolver</a> is then bound into a <a href="./apidocs/org/glassfish/hk2/api/ServiceLocator.html">ServiceLocator</a> like any other service.</p><p>This <a href="../examples/custom-resolver-example/index.html">example</a> adds a custom injection resolver that customizes the default JSR-330 injection resolver.</p></div><div class="section"><h3><a name="Validation">Validation</a></h3><p>In this example we show how the <a href="./apidocs/org/glassfish/hk2/api/ValidationService.html">ValidationService</a> can be used to do a complete security lockdown of the system. This example runs with the J2SE security manager turned on and grants some privileges to some projects and other privileges to other projects to ensure that the <a href="./apidocs/org/glassfish/hk2/api/ValidationService.html">ValidationService</a> can be used to define the security of the system.</p><p>The example can be seen <a href="../examples/security-lockdown-example/security-lockdown-example-runner/index.html">here</a>.</p></div><div class="section"><h3><a name="Instance_Lifecycle">Instance Lifecycle</a></h3><p>A user may register an implementation of <a href="./apidocs/org/glassfish/hk2/api/InstanceLifecycleListener.html">InstanceLifecycleListener</a> to be notified whenver an instance of a service is created. Unlike the <a href="./apidocs/org/glassfish/hk2/api/ValidationService.html">ValidationService</a>, which deals only with the metadata of a service, the <a href="./apidocs/org/glassfish/hk2/api/InstanceLifecycleListener.html">InstanceLifecycleListener</a> is notified whenever an instance of a service is created or destroyed. This is a useful facility for tracing or for scenarios where a service wishes to become an automatic listener for anything that it is injected into.</p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2013
    
          Oracle Corporation
          
  

  
  
  &nbsp;| Last Published: 01/22/2013
  &nbsp;| Version: 2.1.53-SNAPSHOT
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
