<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>Configuration Implementation Details</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
          <meta name="author" content="Jerome Dochez" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      </head>
  <body class="composite">
    <!-- TODO: move this into JavaScript to patch the skin
      <div class="xright">  </div>
    -->
    <div id="bodyColumn">
      <div id="contentBox">
        <p>This page contains some information on the implementation of the configuration backend, it is not targeted to users of the technology but for individuals who want to understand the implementation.</p><div class="section"><h2>XML I/O<a name="XML_IO"></a></h2><p>The first question at hand is how do we process the reading and writing of the XML when all the users has to do is to write a set of @Configured annotated interfaces to describe the document model. Let's divide the question in two parts, the reading first and then the writing.</p><div class="section"><h3>Reading<a name="Reading"></a></h3><p>The process of reading XML files from the set of annotated interfaces can be roughly divided in 3 steps : * Build time generation (APT plugin). * Runtime model construction * XML parsing and binding</p><div class="section"><h4>Build time generation<a name="Build_time_generation"></a></h4><p>In order to limit the processing time at startup, a fair amount of metadata is generated during build time to be able to generate an in memory model of the XML document in a minimum amount of time. That metadata resides in the usual META-INF/inhabitant file, but it is not directly generated there.</p><div class="section"><h5>Configuration metadata format.<a name="Configuration_metadata_format."></a></h5><p>metadata: target=data-type, (attribute | element, ?)+ attribute: @name=(optional | default:boolean-type | datatype:data-type | leaf, ?)+ element: <i>name</i>=element-metadata ] element-metadata: (collection:)? + target-type name: [a..z-_]+ boolean-type=(true | false) data-type: Class#getName() name of a type</p></div><div class="section"><h5>Generation<a name="Generation"></a></h5><p>The META-INF/inhabitant file is not directly modified to include the above metadata, instead an APT plugin is registered when compiling hk2 bundles will look for all @Configured annotated interfaces. For each interface, the APT plugin will generate a small class called Injector that will contain all the metadata above in its @Service annotation. This will allow the normal HK2 auto-depends plugin to use this @Service annotation information and store it inside the META-INF/inhabitant file. Such injector is also registered under the XML name it is mapping.</p></div><div class="section"><h5>Example<a name="Example"></a></h5><div class="section"><h6>@Configured annotated interface<a name="aConfigured_annotated_interface"></a></h6><div class="source"><pre>@Configured
public interface Property extends ConfigBeanProxy, Injectable  {

    /**
     * Gets the value of the name property.
     *
     * @return possible object is
     *         {@link String }
     */
    @Attribute(required = true, key=true)
    public String getName();

    /**
     * Sets the value of the name property.
     *
     * @param value allowed object is
     *              {@link String }
     * @throws PropertyVetoException if a listener vetoes the change
     */
    public void setName(String value) throws PropertyVetoException;

    /**
     * Gets the value of the value property.
     *
     * @return possible object is
     *         {@link String }
     */
    @Attribute(required = true)
    public String getValue();

    /**
     * Sets the value of the value property.
     *
     * @param value allowed object is
     *              {@link String }
     * @throws PropertyVetoException if a listener vetoes the change
     */
    public void setValue(String value) throws PropertyVetoException;

    /**
     * Gets the value of the description property.
     *
     * @return possible object is
     *         {@link String }
     */
    @Attribute
    public String getDescription();

    /**
     * Sets the value of the description property.
     *
     * @param value allowed object is
     *              {@link String }
     * @throws PropertyVetoException if a listener vetoes the change
     */
    public void setDescription(String value) throws PropertyVetoException;
}</pre></div></div><div class="section"><h6>Generated Injector class<a name="Generated_Injector_class"></a></h6><div class="source"><pre>@Service(name = &quot;property&quot;, metadata = &quot;target=org.jvnet.hk2.config.types.Property,@name=required,@name=datatype:java.lang.String,@name=leaf,key=@name,keyed-as=org.jvnet.hk2.config.types.Property,@value=required,@value=datatype:java.lang.String,@value=leaf,@description=optional,@description=datatype:java.lang.String,@description=leaf&quot;)
@InjectionTarget(Property.class)
public class PropertyInjector extends NoopConfigInjector
{

}</pre></div></div><div class="section"><h6>Generated inhabitant file<a name="Generated_inhabitant_file"></a></h6><div class="source"><pre>class=org.jvnet.hk2.config.types.PropertyInjector,index=org.jvnet.hk2.config.ConfigInjector:property,index=org.jvnet.hk2.config.InjectionTarget:org.jvnet.hk2.config.types.Property,target=org.jvnet.hk2.config.types.Property,@name=required,@name=datatype:java.lang.String,@name=leaf,key=@name,keyed-as=org.jvnet.hk2.config.types.Property,@value=required,@value=datatype:java.lang.String,@value=leaf,@description=optional,@description=datatype:java.lang.String,@description=leaf</pre></div></div></div></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2012
    
          Oracle Corporation
          
  

  
  
  &nbsp;| Last Published: 01/11/2012
  &nbsp;| Version: 1.6.30-SNAPSHOT
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
